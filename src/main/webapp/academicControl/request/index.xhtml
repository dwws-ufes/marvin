<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:p="http://primefaces.org/ui"
   xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
   xmlns:adm="http://github.com/adminfaces"
   template="/WEB-INF/templates/template.xhtml">
   <ui:define name="title">
      <h:outputText value="#{msgsAcademicControl['request.title']}" />
   </ui:define>
   <ui:define name="description">
      <h:outputText value="#{msgsAcademicControl['request.title.description']}" />
   </ui:define>
   <ui:define name="body">
      <!-- The breadcrumb. -->
      <adm:breadcrumb title="#{msgsAcademicControl['request.title']}" link="index.xhtml" />
      <!-- The listing form. -->
      <ui:decorate template="/WEB-INF/templates/form-nobox.xhtml">
         <ui:param name="formName" value="listingForm" />
         <p:dataTable
            widgetVar="listingTable"
            value="#{requestController.requests}" 
            var="entity" 
            rows="#{requestController.maxDataTableRowsPerPage}" 
            rowsPerPageTemplate="#{requestController.halfMaxDataTableRowsPerPage},#{requestController.maxDataTableRowsPerPage},#{requestController.doubleMaxDataTableRowsPerPage}"
            lazy="true" 
            paginator="true" 
            selection="#{requestController.selectedEntity}" 
            selectionMode="single" 
            rowKey="#{entity.uuid}"
            paginatorPosition="bottom" 
            loadingMessage="#{msgs['jbutler.text.ajax.loading']}" 
            emptyMessage="#{requestController.filtering ? msgsAcademicControl['request.text.noEntitiesFiltered'] : msgsAcademicControl['request.text.noEntities']}">
            <p:column headerText="#{msgsAcademicControl['request.field.requester']}">
               <h:outputText value="#{entity.requester.name}" />
            </p:column>
            <p:column headerText="#{msgsAcademicControl['deadline.field.deadline.deadlineType']}">
               <h:outputText value="#{entity.deadline.name}" />
            </p:column>
            <p:column headerText="#{msgsAcademicControl['request.requestSituation']}">
               <h:outputText value="#{entity.requestSituation.code}" />
            </p:column>
            <p:column headerText="#{msgsAcademicControl['request.requestDate']}">
               <h:outputText value="#{entity.requestDate}" />
            </p:column>
            <p:column headerText="#{msgsAcademicControl['request.responseDate']}" >
               <h:outputText value="#{entity.responseDate}" />
            </p:column>
            <p:ajax event="rowSelect" update=":listingForm:buttonsGroup" />
            <p:ajax event="rowUnselect" update=":listingForm:buttonsGroup" />
         </p:dataTable>
         <!-- Buttons shown below the listing. -->
         <h:panelGroup id="buttonsGroup">
            <ui:decorate template="/WEB-INF/templates/formbuttonpanel.xhtml">
               <p:commandButton id="changeStatusButton" action="#{requestController.changeStatus}" value="#{msgsAcademicControl['request.button.changeStatus']}" rendered="#{sessionController.admin || sessionController.staff}" disabled="#{requestController.selectedEntity == null or requestController.selectedEntity.requestSituation != 'WAITING'}" icon="fa fa-fw fa-refresh" />
               <p:commandButton id="revokeStatusButton" action="#{requestController.revokeStatus}" value="#{msgsAcademicControl['request.button.revokeStatus']}" rendered="#{sessionController.admin || sessionController.staff}" disabled="#{requestController.selectedEntity == null or requestController.selectedEntity.requestSituation == 'WAITING' or requestController.selectedEntity.requestSituation == 'UNDER_ANALYSIS'}" icon="fa fa-fw fa-refresh" />
               <p:commandButton id="startRequestReponseButton" action="#{requestController.startRequestReponse}" value="#{msgsAcademicControl['request.button.requestRequestReponse']}" rendered="#{sessionController.admin || sessionController.staff}" disabled="#{requestController.selectedEntity == null}" icon="fa fa-fw fa-refresh" />               
               <p:commandButton action="#{requestController.create}" value="#{msgs['jbutler.crud.button.create']}" rendered="#{sessionController.admin || sessionController.student}" icon="fa fa-fw fa-plus" />
               <p:commandButton action="#{requestController.trash}" value="#{msgs['jbutler.crud.button.delete']}" icon="fa fa-fw fa-trash-o" rendered="#{sessionController.admin || sessionController.student}" disabled="#{requestController.selectedEntity == null or requestController.selectedEntity.requestSituation != 'WAITING'}" process="@this" update="trashGroup" />
            </ui:decorate>
         </h:panelGroup>
         <!-- The trash panel: shows entities that have been selected for deletion. -->
         <h:panelGroup id="trashGroup">
            <p:panel id="trashPanel" header="#{msgs['jbutler.crud.text.trashHeader']}" rendered="#{not empty requestController.trashCan}" style="margin-top: 20px">
               <p:dataList value="#{requestController.trashCan}" var="entity" type="ordered">
                  #{entity.requester.name} #{entity.deadline.name} #{entity.requestSituation} #{entity.requestDate} #{entity.responseDate}
               </p:dataList>
               <ui:decorate template="/WEB-INF/templates/formbuttonpanel.xhtml">
                  <p:commandButton action="#{requestController.cancelDeletion}" value="#{msgs['jbutler.crud.button.cancelDeletion']}" icon="fa fa-fw fa-close" process="@this" update=":listingForm" />
                  <p:commandButton action="#{requestController.delete}" value="#{msgs['jbutler.crud.button.confirmDeletion']}" icon="fa fa-fw fa-trash-o" process="@this" update=":messages :info-messages :listingForm" />
               </ui:decorate>
            </p:panel>
         </h:panelGroup>
      </ui:decorate>
   </ui:define>
</ui:composition>